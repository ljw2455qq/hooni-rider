<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê±°ë¦¬ í‘œì‹œ ì˜¤ë²„ë ˆì´</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: transparent;
            overflow: hidden;
        }

        .distance-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.8), rgba(50, 50, 50, 0.8));
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 25px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            min-width: 200px;
            text-align: center;
        }

        .distance-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }

        .distance-value {
            font-size: 32px;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            font-family: 'Courier New', monospace;
            margin: 0;
            line-height: 1;
        }

        .distance-unit {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            margin-left: 5px;
            font-weight: normal;
        }

        .status {
            font-size: 10px;
            margin-top: 8px;
            padding: 4px 8px;
            border-radius: 8px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status.connected {
            background: rgba(76, 175, 80, 0.8);
            color: white;
        }

        .status.connecting {
            background: rgba(255, 152, 0, 0.8);
            color: white;
            animation: pulse 2s infinite;
        }

        .status.disconnected {
            background: rgba(244, 67, 54, 0.8);
            color: white;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .icon {
            font-size: 14px;
            margin-right: 5px;
        }

        /* ë‹¤ì–‘í•œ í…Œë§ˆ ì˜µì…˜ */
        .theme-minimal {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(5px);
        }

        .theme-gaming {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.8), rgba(30, 144, 255, 0.8));
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .theme-neon {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        .theme-neon .distance-value {
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }
    </style>
</head>
<body>
    <div class="distance-container" id="distanceContainer">
        <div class="distance-label">
            <span class="icon">ğŸƒâ€â™‚ï¸</span>ì´ ê±°ë¦¬
        </div>
        <div class="distance-value" id="distanceValue">
            0.00<span class="distance-unit">km</span>
        </div>
        <div class="status connecting" id="status">
            ì—°ê²° ì¤‘...
        </div>
    </div>

    <script>
        // URL íŒŒë¼ë¯¸í„°ì—ì„œ í‚¤ì™€ ì„¤ì • ê°€ì ¸ì˜¤ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const apiKey = urlParams.get('key') || 'zeoeyze9htbyx455';
        const theme = urlParams.get('theme') || 'default';
        const refreshInterval = parseInt(urlParams.get('refresh')) || 5000; // 5ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸

        // í…Œë§ˆ ì ìš©
        if (theme !== 'default') {
            document.getElementById('distanceContainer').classList.add(`theme-${theme}`);
        }

        // ìƒíƒœ ìš”ì†Œë“¤
        const distanceValueEl = document.getElementById('distanceValue');
        const statusEl = document.getElementById('status');

        // RTIRL APIì—ì„œ ê±°ë¦¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function fetchDistance() {
            try {
                statusEl.textContent = 'ì—…ë°ì´íŠ¸ ì¤‘...';
                statusEl.className = 'status connecting';

                // RTIRL API í˜¸ì¶œ (ì‹¤ì œ API ì—”ë“œí¬ì¸íŠ¸ëŠ” ë¬¸ì„œ í™•ì¸ í•„ìš”)
                const response = await fetch(`https://overlays.rtirl.com/api/distance?key=${apiKey}`);
                
                if (response.ok) {
                    const data = await response.json();
                    const distanceKm = (data.distance / 1000).toFixed(2); // ë¯¸í„°ë¥¼ í‚¬ë¡œë¯¸í„°ë¡œ ë³€í™˜
                    
                    distanceValueEl.innerHTML = `${distanceKm}<span class="distance-unit">km</span>`;
                    statusEl.textContent = 'ì—°ê²°ë¨';
                    statusEl.className = 'status connected';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                console.error('ê±°ë¦¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                distanceValueEl.innerHTML = `--<span class="distance-unit">km</span>`;
                statusEl.textContent = 'ì—°ê²° ì‹¤íŒ¨';
                statusEl.className = 'status disconnected';
            }
        }

        // iframeìœ¼ë¡œ RTIRL ê±°ë¦¬ ì˜¤ë²„ë ˆì´ ì§ì ‘ ë¡œë“œ (ëŒ€ì•ˆ ë°©ë²•)
        function loadRTIRLOverlay() {
            if (apiKey !== 'zeoeyze9htbyx455') {
                const iframe = document.createElement('iframe');
                iframe.src = `https://overlays.rtirl.com/distance/km.html?key=${apiKey}`;
                iframe.style.width = '100%';
                iframe.style.height = '100%';
                iframe.style.border = 'none';
                iframe.style.background = 'transparent';
                
                // ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ìˆ¨ê¸°ê³  iframe í‘œì‹œ
                document.body.innerHTML = '';
                document.body.appendChild(iframe);
                return;
            }
        }

        // WebSocket ì—°ê²° ì‹œë„ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸)
        function connectWebSocket() {
            try {
                const ws = new WebSocket(`wss://overlays.rtirl.com/ws?key=${apiKey}`);
                
                ws.onopen = function() {
                    statusEl.textContent = 'ì‹¤ì‹œê°„ ì—°ê²°';
                    statusEl.className = 'status connected';
                };

                ws.onmessage = function(event) {
                    const data = JSON.parse(event.data);
                    if (data.type === 'distance') {
                        const distanceKm = (data.value / 1000).toFixed(2);
                        distanceValueEl.innerHTML = `${distanceKm}<span class="distance-unit">km</span>`;
                    }
                };

                ws.onclose = function() {
                    statusEl.textContent = 'ì—°ê²° ëŠê¹€';
                    statusEl.className = 'status disconnected';
                    // 5ì´ˆ í›„ ì¬ì—°ê²° ì‹œë„
                    setTimeout(connectWebSocket, 5000);
                };

                ws.onerror = function() {
                    // WebSocket ì‹¤íŒ¨ ì‹œ HTTP í´ë§ìœ¼ë¡œ ëŒ€ì²´
                    console.log('WebSocket ì‹¤íŒ¨, HTTP í´ë§ìœ¼ë¡œ ì „í™˜');
                    startPolling();
                };
            } catch (error) {
                startPolling();
            }
        }

        // HTTP í´ë§ ì‹œì‘
        function startPolling() {
            fetchDistance();
            setInterval(fetchDistance, refreshInterval);
        }

        // ì´ˆê¸°í™”
        function init() {
            if (apiKey === 'YOUR_PULL_KEY') {
                statusEl.textContent = 'API í‚¤ í•„ìš”';
                statusEl.className = 'status disconnected';
                distanceValueEl.innerHTML = `--<span class="distance-unit">km</span>`;
                return;
            }

            // RTIRL ì˜¤ë²„ë ˆì´ ì§ì ‘ ë¡œë“œ ì˜µì…˜
            const useDirectOverlay = urlParams.get('direct') === 'true';
            if (useDirectOverlay) {
                loadRTIRLOverlay();
                return;
            }

            // WebSocket ì—°ê²° ì‹œë„, ì‹¤íŒ¨ ì‹œ HTTP í´ë§
            connectWebSocket();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', init);

        // í˜ì´ì§€ visibility ë³€ê²½ ì‹œ ì—°ê²° ê´€ë¦¬
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // í˜ì´ì§€ê°€ ìˆ¨ê²¨ì§€ë©´ ì—°ê²° ì¼ì‹œ ì •ì§€
            } else {
                // í˜ì´ì§€ê°€ ë‹¤ì‹œ ë³´ì´ë©´ ì—°ê²° ì¬ê°œ
                init();
            }
        });
    </script>
</body>
</html>
