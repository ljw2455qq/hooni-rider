<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPS ê±°ë¦¬ ì¶”ì ê¸°</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .distance-display {
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .total-distance {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .info-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.5em;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .controls {
            text-align: center;
            margin: 20px 0;
        }

        button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status {
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            font-weight: bold;
        }

        .status.active {
            background: rgba(76, 175, 80, 0.8);
        }

        .status.inactive {
            background: rgba(244, 67, 54, 0.8);
        }

        .api-selector {
            margin: 20px 0;
            text-align: center;
        }

        select {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin: 0 10px;
        }

        option {
            background: #333;
            color: white;
        }

        .route-log {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .tracking {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; margin-bottom: 30px;">ğŸ—ºï¸ GPS ê±°ë¦¬ ì¶”ì ê¸°</h1>

        <div class="api-selector">
            <label>API ì„ íƒ:</label>
            <select id="apiType">
                <option value="browser">ë¸Œë¼ìš°ì € GPS API</option>
                <option value="google">Google Maps API</option>
                <option value="openweather">OpenWeather API</option>
            </select>
            <input type="text" id="apiKey" placeholder="API í‚¤ (í•„ìš”ì‹œ)" style="margin-left: 10px; padding: 8px; border-radius: 5px; border: 1px solid #ccc;">
        </div>

        <div class="distance-display">
            <div style="font-size: 1.2em; margin-bottom: 10px;">ì´ ì´ë™ê±°ë¦¬</div>
            <div class="total-distance" id="totalDistance">0.00 km</div>
        </div>

        <div class="info-grid">
            <div class="info-card">
                <div class="info-label">í˜„ì¬ ìœ„ë„</div>
                <div class="info-value" id="latitude">--</div>
            </div>
            <div class="info-card">
                <div class="info-label">í˜„ì¬ ê²½ë„</div>
                <div class="info-value" id="longitude">--</div>
            </div>
            <div class="info-card">
                <div class="info-label">í˜„ì¬ ì†ë„</div>
                <div class="info-value" id="speed">-- km/h</div>
            </div>
            <div class="info-card">
                <div class="info-label">ì •í™•ë„</div>
                <div class="info-value" id="accuracy">-- m</div>
            </div>
        </div>

        <div class="controls">
            <button id="startBtn" onclick="startTracking()">ì¶”ì  ì‹œì‘</button>
            <button id="stopBtn" onclick="stopTracking()" disabled>ì¶”ì  ì¤‘ì§€</button>
            <button onclick="resetDistance()">ê±°ë¦¬ ì´ˆê¸°í™”</button>
            <button onclick="exportData()">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
        </div>

        <div class="status inactive" id="status">ì¶”ì  ì¤‘ì§€ë¨</div>

        <div class="route-log" id="routeLog">
            <div>ì¶”ì  ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>
    </div>

    <script>
        let isTracking = false;
        let watchId = null;
        let totalDistance = 0;
        let lastPosition = null;
        let positions = [];

        // API í‚¤ ë° ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •
        const API_CONFIGS = {
            google: {
                geocoding: 'https://maps.googleapis.com/maps/api/geocode/json',
                directions: 'https://maps.googleapis.com/maps/api/directions/json'
            },
            openweather: {
                geo: 'http://api.openweathermap.org/geo/1.0/direct'
            }
        };

        // Haversine ê³µì‹ìœ¼ë¡œ ë‘ ì§€ì  ê°„ ê±°ë¦¬ ê³„ì‚° (km)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // ì§€êµ¬ ë°˜ì§€ë¦„ (km)
            const dLat = toRad(lat2 - lat1);
            const dLon = toRad(lon2 - lon1);
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
                     Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function toRad(value) {
            return value * Math.PI / 180;
        }

        // ë¸Œë¼ìš°ì € GPS API ì‚¬ìš©
        function startBrowserTracking() {
            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 1000
            };

            watchId = navigator.geolocation.watchPosition(
                handlePosition,
                handleError,
                options
            );
        }

        // Google Maps API ì‚¬ìš© (ì—­ì§€ì˜¤ì½”ë”©)
        async function reverseGeocodeGoogle(lat, lng) {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) return null;

            try {
                const response = await fetch(
                    `${API_CONFIGS.google.geocoding}?latlng=${lat},${lng}&key=${apiKey}`
                );
                const data = await response.json();
                return data.results[0]?.formatted_address || '';
            } catch (error) {
                console.error('Google API ì˜¤ë¥˜:', error);
                return null;
            }
        }

        // ìœ„ì¹˜ ì •ë³´ ì²˜ë¦¬
        async function handlePosition(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            const accuracy = position.coords.accuracy;
            const speed = position.coords.speed;

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('latitude').textContent = lat.toFixed(6);
            document.getElementById('longitude').textContent = lon.toFixed(6);
            document.getElementById('accuracy').textContent = `Â±${accuracy.toFixed(0)}m`;
            document.getElementById('speed').textContent = speed ? 
                `${(speed * 3.6).toFixed(1)} km/h` : '0.0 km/h';

            // ê±°ë¦¬ ê³„ì‚°
            if (lastPosition) {
                const distance = calculateDistance(
                    lastPosition.lat, lastPosition.lon,
                    lat, lon
                );
                
                // ì •í™•ë„ê°€ ì¢‹ê³ , ì´ë™ê±°ë¦¬ê°€ í•©ë¦¬ì ì¼ ë•Œë§Œ ì¶”ê°€
                if (accuracy < 50 && distance < 1) { // 1km ì´ìƒ ì í”„ëŠ” ë¬´ì‹œ
                    totalDistance += distance;
                    document.getElementById('totalDistance').textContent = 
                        `${totalDistance.toFixed(2)} km`;
                    
                    logPosition(lat, lon, distance);
                }
            }

            lastPosition = { lat, lon };
            positions.push({
                timestamp: new Date(),
                lat,
                lon,
                accuracy,
                speed: speed || 0
            });

            // APIë³„ ì¶”ê°€ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const apiType = document.getElementById('apiType').value;
            if (apiType === 'google') {
                const address = await reverseGeocodeGoogle(lat, lon);
                if (address) {
                    logMessage(`ì£¼ì†Œ: ${address.substring(0, 50)}...`);
                }
            }
        }

        function handleError(error) {
            const messages = {
                1: 'ìœ„ì¹˜ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.',
                2: 'ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
                3: 'ìœ„ì¹˜ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.'
            };
            
            logMessage(`ì˜¤ë¥˜: ${messages[error.code] || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
            document.getElementById('status').textContent = 'ì˜¤ë¥˜ ë°œìƒ';
            document.getElementById('status').className = 'status inactive';
        }

        function logPosition(lat, lon, distance) {
            const time = new Date().toLocaleTimeString();
            const message = `${time}: ${lat.toFixed(6)}, ${lon.toFixed(6)} (+${(distance*1000).toFixed(0)}m)`;
            logMessage(message);
        }

        function logMessage(message) {
            const log = document.getElementById('routeLog');
            const div = document.createElement('div');
            div.textContent = message;
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }

        function startTracking() {
            if (!navigator.geolocation) {
                alert('ì´ ë¸Œë¼ìš°ì €ëŠ” GPSë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }

            isTracking = true;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('status').textContent = 'GPS ì¶”ì  ì¤‘...';
            document.getElementById('status').className = 'status active tracking';

            startBrowserTracking();
            logMessage('ì¶”ì ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤.');
        }

        function stopTracking() {
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
            }

            isTracking = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('status').textContent = 'ì¶”ì  ì¤‘ì§€ë¨';
            document.getElementById('status').className = 'status inactive';

            logMessage('ì¶”ì ì„ ì¤‘ì§€í–ˆìŠµë‹ˆë‹¤.');
        }

        function resetDistance() {
            if (confirm('ê±°ë¦¬ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                totalDistance = 0;
                lastPosition = null;
                positions = [];
                document.getElementById('totalDistance').textContent = '0.00 km';
                document.getElementById('routeLog').innerHTML = '<div>ì¶”ì  ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>';
                logMessage('ê±°ë¦¬ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        function exportData() {
            const data = {
                totalDistance,
                positions,
                exportTime: new Date()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], {
                type: 'application/json'
            });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `gps-tracking-${new Date().getTime()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì¶”ì  ì¤‘ì§€
        window.addEventListener('beforeunload', function() {
            if (isTracking) {
                stopTracking();
            }
        });

        // ì´ˆê¸° ë©”ì‹œì§€
        logMessage('GPS ì¶”ì ê¸°ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. "ì¶”ì  ì‹œì‘" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.');
    </script>
</body>
</html>
